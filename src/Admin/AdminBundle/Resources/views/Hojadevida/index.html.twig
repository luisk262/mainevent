{% extends 'AdminAdminBundle:Dashboard:tables.html.twig' %}
{% if (is_granted("ROLE_ADMIN")) or (is_granted("ROLE_CORDI")) or (is_granted("ROLE_SUPER_ADMIN")) %}

    {% block nombreformulario %}Todos los Registros {%endblock%}

    {% block nombretabla %}    
        <div class="caption">
            <strong>Total:</strong> <em>{{ entitiesLength }} Registros</em>
        </div>

    {%endblock%}

    {%block tabla %}

        <form  id="jsForm" role="form" method="GET" action="" >
            <input id="pagenumber" type="hidden" name="searchParam[page]" value="1"> 
            <div class="row">
                <div class="col-md-5 form-group">
                    <div class="input-group">
                        <input type="text" name="searchParam[general]" class="form-control" placeholder="Búsqueda rápida">
                        <div class="input-group-btn">
                            <button class="btn btn-default" type="submit"><span class="glyphicon glyphicon-search"></span></button>
                        </div><!-- /btn-group -->
                    </div><!-- /input-group -->
                </div>
                <div class="col-md-2">
                    <div class="col-md-9">
                        <select id="js-perpage" name="searchParam[perPage]" class="form-control">
                            <option value="10" selected="">10</option>
                            <option value="20">20</option>
                            <option value="50">50</option>
                            <option value="100" >100</option>
                        </select>
                    </div>
                </div>
                <div class="col-md-5">
                    <div class="btn-group pull-right">                       
                        <button class="btn btn-primary "><span class="glyphicon glyphicon-cog"></span>Seleccione una acción</button>
                        <button class="btn btn-primary dropdown-toggle" data-toggle="dropdown">
                            <span class="caret"></span>
                        </button>
                        <ul class="dropdown-menu" role="menu">
                            <li><a href="{{path('hojadevida_new')}}"><span class="glyphicon glyphicon-plus"></span> Nueva</a></li>
                            <li><a  href="#" data-toggle="modal" data-target="#emailModal" id="js-email"><span class="fa fa-envelope-o"></span>Enviar correo electrónico</a></li>
                            <li><a href="#" data-toggle="modal" data-target="#searchModal"><span class="glyphicon glyphicon-glass"></span> Búsqueda avanzada</a></li>
                        {% if Estado=='Inactivo' %}    
                            <li><a href="#" id="js-delete"><span class="glyphicon glyphicon-trash"></span>Eliminar</a></li>
                        {%endif%}
                        </ul>
                    </div>
                </div>


            </div>
            <div class="row">
                <div class="col-sm-12">
                    <table  class="table table-striped table-bordered table-hover dataTable no-footer" id="dataTables-example" aria-describedby="dataTables-example_info" role="grid">
                        <thead>
                            <tr role="row">
                                <th>
                                    Id
                                </th>
                                <th>Foto</th>
                                <th>Nombre</th>
                                <th>Apellido</th>
                                <th>Ciudad</th>
                                <th>Emailpersonal</th>
                                <th>Estatura</th>
                                <th>Edad</th>
                                <th>Telce</th>

                                <th>Acciones</th>
                            </tr>
                        </thead>
                        <tbody id='dataContainer'>
                        </tbody>
                    </table>
                </div >
            </div >

            <!-- Modal advanced search -->
            <div class="modal fade" id="searchModal" tabindex="-1" role="dialog" aria-labelledby="searchModalLabel" aria-hidden="true">
                <div class="modal-dialog">
                    <div class="modal-content">
                        <div class="modal-header">
                            <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
                            <h4 class="modal-title" id="searchModalLabel">Busqueda Avanzada</h4>
                        </div>
                        <div class="modal-body form-horizontal">


                            <div class="form-group">
                                <label for="" class="col-sm-5 control-label">Id</label>
                                <div class="col-sm-6">
                                    <input type="text" name="searchParam[idhv]" class="form-control">
                                </div>
                            </div>
                            <div class="form-group">
                                <label for="" class="col-sm-5 control-label">Ciudad</label>
                                <div class="col-sm-6">
                                    <input type="text" name="searchParam[ciudad]" class="form-control">
                                </div>
                            </div>
                            <div class="form-group">
                                <label for="" class="col-sm-5 control-label">Celular</label>
                                <div class="col-sm-6">
                                    <input type="text" name="searchParam[telCe]" class="form-control">
                                </div>
                            </div>
                            <div class="form-group">
                                <label for="" class="col-sm-5 control-label">fechaNac</label>
                                <div class="col-sm-6">
                                    <input type="text" name="searchParam[fechaNac]" placeholder="año/mes/dia" class="form-control">
                                </div>
                            </div>
                            <div class="form-group">
                                <label for="" class="col-sm-5 control-label">Edad</label>
                                <div class="col-sm-3">
                                    <select name="searchParam[EdadMin]" class="form-control">
                                        <option value="" selected="selected">Min</option>
                                        {% for i in 1..100 %}
                                            <option value="{{ i }}">{{ i }}</option>
                                        {% endfor %}
                                    </select>
                                </div>
                                <div class="col-sm-3">
                                    <select name="searchParam[EdadMax]" class="form-control">
                                        <option value="" selected="selected">Max</option>
                                        {% for i in 0..100 %}
                                            <option value="{{ i }}">{{ i }}</option>
                                        {% endfor %}
                                    </select>
                                </div>
                            </div>
                            <div class="form-group">
                                <label for="" class="col-sm-5 control-label">Documento</label>
                                <div class="col-sm-6">
                                    <input type="text" name="searchParam[nit]" class="form-control">
                                </div>
                            </div>
                            <div class="form-group">
                                <label  class="col-sm-5 control-label">Genero</label>
                                <div class="col-sm-6">
                                    <select name="searchParam[sexo]" class="form-control">
                                        <option value="" selected="selected">Seleccione tipo</option>
                                        <option value="Masculino" >Masculino</option>
                                        <option value="Femenino">Femenino</option></select>
                                </div>
                            </div>
                            <div class="form-group">
                                <label for="" class="col-sm-5 control-label">Lugar de nacimiento </label>
                                <div class="col-sm-6">
                                    <input type="text" name="searchParam[lugarNacimiento]" class="form-control">
                                </div>
                            </div>
                            <div class="form-group">
                                <label for="" class="col-sm-5 control-label">Estatura</label>
                                <div class="col-sm-6">
                                    <input type="text" name="searchParam[estatura]" class="form-control">
                                </div>
                            </div>

                            <div class="form-group">
                                <label for="" class="col-sm-5 control-label">Color de piel</label>
                                <div class="col-sm-6">
                                    <select name="searchParam[piel]" class="form-control">
                                        <option value="" selected="selected">Seleccione </option>
                                        <option value="Amarilla" >Amarilla</option>
                                        <option value="Blanca">Blanca</option>
                                        <option value="Indigena">Indigena</option>
                                        <option value="Mestiza">Mestiza</option>
                                        <option value="Negra">Negra</option>
                                        <option value="Roja">Roja</option>
                                        <option value="Trigeña">Trigeña</option>
                                        <option value="Otro">Otro</option>
                                    </select>

                                </div>
                            </div>

                            <div class="form-group">
                                <label for="" class="col-sm-5 control-label">Color de ojos</label>
                                <div class="col-sm-6">
                                    <select name="searchParam[ojos]" class="form-control">
                                        <option value="" selected="selected">Seleccione </option>
                                        <option value="Cafes" >Cafes</option>
                                        <option value="Azules">Azules</option>
                                        <option value="Negros">Negros</option>
                                        <option value="Verdes">Verdes</option>
                                        <option value="Otro">Otro</option></select>
                                </div>
                            </div>

                            <div class="form-group">
                                <label for="" class="col-sm-5 control-label">Color de cabello</label>
                                <div class="col-sm-6">
                                    <select name="searchParam[pelo]" class="form-control">
                                        <option value="" selected="selected">Seleccione </option>
                                        <option value="Castaño oscuro" >Castaño oscuro</option>
                                        <option value="Castaño">Castaño</option>
                                        <option value="Negro">Negro</option>
                                        <option value="Rojo">Rojo</option>
                                        <option value="Rubio">Rubio</option>
                                        <option value="Otro">Otro</option>
                                    </select>

                                </div>
                            </div>
                            <div class="form-group">
                                <label for="" class="col-sm-5 control-label">Peso</label>
                                <div class="col-sm-6">
                                    <input type="text" name="searchParam[peso]" class="form-control">
                                </div>
                            </div>
                            <div class="form-group">
                                <label for="" class="col-sm-5 control-label">Deportes</label>
                                <div class="col-sm-6">
                                    <input type="text" name="searchParam[deportes]" class="form-control">
                                </div>
                            </div>
                            <div class="form-group">
                                <label for="" class="col-sm-5 control-label">Habilidades</label>
                                <div class="col-sm-6">
                                    <input type="text" name="searchParam[habilidades]" class="form-control">
                                </div>
                            </div>
                            <div class="form-group">
                                <label for="" class="col-sm-5 control-label">Idiomas</label>
                                <div class="col-sm-6">
                                    <input type="text" name="searchParam[idiomas]" class="form-control">
                                </div>
                            </div>
                            <div class="form-group">
                                <label for="" class="col-sm-5 control-label">Maneja</label>
                                <div class="col-sm-6">
                                    <select id="admin_adminbundle_hojadevida_maneja" name="searchParam[maneja]" class="form-control"><option value=""selected="selected" >Seleccione</option><option value="No" >No</option><option value="Carro">Carro</option><option value="Moto">Moto</option><option value="Carro y Moto">Carro y Moto</option><option value="Otro">Otro</option></select>
                                </div>
                            </div>
                            <div class="form-group">
                                <label for="" class="col-sm-5 control-label">Entidad de salud</label>
                                <div class="col-sm-6">
                                    <input type="text" name="searchParam[entidadSalud]" class="form-control">
                                </div>
                            </div>
                            <div class="form-group">
                                <label for="" class="col-sm-5 control-label">Categoría</label>
                                <div class="col-sm-6">
                                    <select name="searchParam[categoria]" class="form-control">
                                        <option value="" selected="selected">Seleccione</option>
                                        <option value="Actor" >Actor</option><option value="Actor en formacion">Actor en formacion</option><option value="Figurante">Figurante</option><option value="Modelo A">Modelo A</option><option value="Modelo AA">Modelo AA</option><option value="Modelo AAA">Modelo AAA</option><option value="Extra A">Extra A</option><option value="Extra AA">Extra AA</option><option value="Extra AAA">Extra AAA</option></select>

                                </div>
                            </div>
                            <div class="form-group">
                                <label for="" class="col-sm-5 control-label">Talla de camisa</label>
                                <div class="col-sm-6">
                                    <select  name="searchParam[tallaCamisa]"  class="form-control">
                                        <option value="" selected="selected">Seleccione </option><option value="1">1</option><option value="2">2</option><option value="4">4</option><option value="6">6</option><option value="8">8</option><option value="10">10</option><option value="12">12</option><option value="XS" >XS</option><option value="S">S</option><option value="L">L</option><option value="M">M</option><option value="XL">XL</option><option value="XXL">XXL</option></select>
                                </div>
                            </div>
                            <div class="form-group">
                                <label for="" class="col-sm-5 control-label">Talla de chaqueta</label>
                                <div class="col-sm-6">
                                    <select name="searchParam[tallaChaqueta]"  class="form-control"><option value="" selected="selected">Seleccione </option><option value="1">1</option><option value="2" >2</option><option value="4">4</option><option value="6">6</option><option value="8">8</option><option value="10">10</option><option value="12">12</option><option value="XS">XS</option><option value="S">S</option><option value="L">L</option><option value="M">M</option><option value="XL">XL</option><option value="XXL">XXL</option></select>

                                </div>
                            </div>
                            <div class="form-group">
                                <label for="" class="col-sm-5 control-label">Talla de pantalón</label>
                                <div class="col-sm-6">
                                    <select  name="searchParam[tallaPantalon]" class="form-control"><option value="" selected="selected">Seleccione </option><option value="1">1</option><option value="2">2</option><option value="4">4</option><option value="6">6</option><option value="8">8</option><option value="10">10</option><option value="12">12</option><option value="XS-28" >XS-28</option><option value="S-30">S-30</option><option value="M-32">M-32</option><option value="L-34">L-34</option><option value="XL-36">XL-36</option><option value="XXL-38">XXL-38</option></select>

                                </div>
                            </div>
                            <div class="form-group">
                                <label for="" class="col-sm-5 control-label">Talla de zapatos</label>
                                <div class="col-sm-6">
                                    <select  name="searchParam[tallaZapato]" class="form-control"><option value="" selected="selected">Seleccione </option><option value="2.5  - 32">2.5 - 32</option><option value="3 - 32.5">3 - 32.5</option><option value="3.5 - 33">3.5 - 33</option><option value="4 - 33.5">4 - 33.5</option><option value="4.5 - 34">4.5 - 34</option><option value="5 - 35.5">5 - 35.5</option><option value="5.5 - 36" >5.5 - 36</option><option value="6 - 36.5">6 - 36.5</option><option value="6.5 - 37">6.5 - 37</option><option value="7 - 37.5">6 - 37.5</option><option value="7.5 - 38">7.5 - 38</option><option value="8 - 38.5">8 - 38.5</option><option value="8.5 - 39">8.5 - 39</option><option value="9 - 39.5">9 - 39.5</option><option value="9.5 - 40">9.5 - 40</option><option value="10 - 40.5">10 - 40.5</option><option value="10.5 - 41">10.5 - 41</option><option value="11 - 41.5">11 - 41.5</option><option value="11.5 - 42">11.5 - 42</option><option value="12 - 42.5">12 - 42.5</option><option value="12.5 - 43">12.5 - 43</option><option value="13 - 43.5">13 - 43.5</option><option value="13.5 - 44">13.5 - 44</option><option value="14 - 44.5">14 - 44.5</option><option value="14.5 - 45">14.5 - 45</option><option value="15 - 45.5">15 - 45.5</option><option value="15.5 - 46">15.5 - 46</option><option value="16 - 46.5">16 - 46.5</option><option value="16 - 47.5">16.5 - 47</option></select>

                                </div>
                            </div>
                            <div class="form-group">
                                <label for="" class="col-sm-5 control-label">Etiqueta</label>
                                <div class="col-sm-6">
                                    <input type="text" name="searchParam[Tags]" class="form-control">
                                </div>
                            </div>

                        </div>
                        <div class="modal-footer">
                            <button class="btn btn-primary">Filtrar</button>
                        </div>
                    </div>
                </div>
            </div>


            <!-- Modal advanced search -->
            <div class="modal fade" id="emailModal" tabindex="-1" role="dialog" aria-labelledby="searchModalLabel" aria-hidden="true">
                <div class="modal-dialog">
                    <div class="modal-content">
                        <div class="modal-header">
                            <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
                            <h4 class="modal-title" id="searchModalLabel">Enviar correo electrónico</h4>
                        </div>
                        <div class="modal-body form-horizontal">
                            <div class="form-group">
                                <label for="" class="col-sm-5 control-label">Asunto</label>
                                <div class="col-sm-6">
                                    <input type="text" name="mail[Subject]" class="form-control">
                                </div>
                            </div>
                            <div class="form-group">
                                <label for="" class="col-sm-5 control-label">Cuerpo</label>
                                <div class="col-sm-6">
                                    <textarea class="form-control" name="mail[Body]" rows="8"></textarea>
                                </div>
                            </div>



                        </div>
                        <div class="modal-footer">
                            <button  id="js-email-submit" class="btn btn-primary">Enviar</button>
                        </div>
                    </div>
                </div>
            </div>
        </form>

    {% endblock %}
{%endif%}
{% block javasctipt %}
    <!-- jQuery -->
    <script src="{{asset('bundles/adminadmin/bower_components/jquery/dist/jquery.min.js')}}"></script>
    <!-- Bootstrap Core JavaScript -->
    <script src="{{asset('bundles/adminadmin/bower_components/bootstrap/dist/js/bootstrap.min.js')}}"></script>
    <!-- Metis Menu Plugin JavaScript -->
    <script src="{{asset('bundles/adminadmin/bower_components/metisMenu/dist/metisMenu.min.js')}}"></script>


    <!-- DataTables JavaScript -->
    <script src="{{asset('bundles/adminadmin/dist/js/sb-admin-2.js')}}"></script>
    <script>
        (function ($) {
            /* helper functions */
            function getCheckedRows() {
                var users = [];
                dataContainer.find('input:checkbox:checked').each(function () {
                    users.push($(this).val());
                });
                return users.join(',');
            }
            function isSelected() {
                if (!getCheckedRows()) {
                    alert('Debe seleccionar al menos un registro');
                    return false;
                }
                ;
                return true;
            }
            function init() {
                pageInput.val('1');
                checkboxBtn.prop("checked", false);
                jsFormUrl = '{{ path('hojadevida_ajax',{'Estado':Estado,'page':current_page}) }}';
            }
            function ajaxPost(action, callback) {
                $('#panel').addClass('panel-warning').removeClass('panel-primary');
                searchModal.modal('hide');
                $.ajax({
                    type: "GET",
                    data: form.serialize(),
                    url: jsFormUrl,
                    success: function (data) {
                        $('#panel').addClass('panel-primary').removeClass('panel-warning');
                        if (callback)
                            callback(data);
                        init();
                        if (!action)
                            dataContainer.empty().hide().html(data).fadeIn();
                        else
                            ajaxPost();
                    },
                    error: function () {
                        alert('Hubo un error');
                        $('#panel').addClass('panel-primary').removeClass('panel-warning');

                    }
                });
                return false;
            }

            /* ajax dashboard*/
            var form = $('#jsForm'),
                    dataContainer = form.find('#dataContainer'),
                    carga = form.find('#carga'),
                    deleteBtn = form.find('#js-delete'),
                    pageInput = form.find('#pagenumber'),
                    sortDirInput = form.find('#sortDir'),
                    searchModal = form.find('#searchModal'),
                    emailBtn = form.find('#js-email'),
                    emailSubmit = form.find('#js-email-submit'),
                    emailModal = form.find('#emailModal'),
                    jsFormUrl = '',
                    checkboxBtn = form.find("input:checkbox");
            /* pagination */
            form.on('click', '.js-page', function () {
                pageInput.val($(this).data('page'));
                ajaxPost();
            });
            /*enviar email*/
            emailBtn.on('click', function () {
                if (!isSelected())
                    return false;
            });
            emailSubmit.on('click', function () {
                Enviarmail('mail');
            });
            function Enviarmail(action, callback) {
                $('#panel').addClass('panel-warning').removeClass('panel-primary');
                emailModal.modal('hide');
                $.ajax({
                    type: "GET",
                    data: form.serialize(),
                    url: '{{ path('hojadevida_mail') }}',
                    success: function (data) {
                        $('#panel').addClass('panel-primary').removeClass('panel-warning');
                        alert('Email enviado satisfactoriamente');

                    },
                    error: function () {
                        alert('Hubo un error');
                        $('#panel').addClass('panel-primary').removeClass('panel-warning');

                    }
                });
                return false;
            }
            /* delete a user */
            deleteBtn.on('click', function () {
                if (!isSelected() || !confirm('Ultima Palabra?'))
                    return false;
                jsFormUrl = '{{ path('hojadevida_remove') }}';
                ajaxPost('delete');
            });

            form.on('submit', function () {
                ajaxPost();
                return false;
            });
            /* submit the form after loading the page*/
            init();
            ajaxPost();

        })(jQuery);
    </script>
{%endblock%}

